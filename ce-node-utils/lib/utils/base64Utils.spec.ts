import { stat } from 'node:fs/promises'
import { Base64Utils } from './base64Utils'
import { describe, it, expect } from 'vitest'
import { join } from 'node:path'

describe('test', () => {
        it('should remove the base64Head', () => {
                const before =
                        'data:image/jpeg;base64,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'

                const after =
                        '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'

                expect(Base64Utils.removeHead(before)).toEqual(after)
        })

        it('should create the image', async () => {
                const filename = 'new-path2.jpg'
                const base64Data =
                        'data:image/jpeg;base64,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'
                const filepath = join(process.cwd(), filename)
                Base64Utils.toImage(filepath, Base64Utils.toBuffer(base64Data))
                const fileStat = await stat(filepath)
                console.log(fileStat)
                expect(fileStat.size).toBeGreaterThan(0)
        })
})
